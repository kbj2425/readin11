<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì íŒ¨ë„ - READIN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #FFC0CB, #FFB6C1);
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: #FFC0CB;
            font-size: 1.8em;
            font-weight: bold;
        }

        .user-menu {
            position: relative;
        }

        .username {
            color: #FFC0CB;
            font-weight: bold;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .username:hover {
            background: #f0f0f0;
        }

        .dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            display: none;
            z-index: 1000;
        }

        .dropdown.show {
            display: block;
        }

        .dropdown a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: #333;
            transition: background 0.3s;
        }

        .dropdown a:hover {
            background: #FFC0CB;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .section-title {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 20px;
            border-bottom: 2px solid #FFC0CB;
            padding-bottom: 10px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #FFC0CB;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .search-section {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #FFC0CB;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .users-table th {
            background: #FFC0CB;
            color: white;
            font-weight: bold;
        }

        .level-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }

        .action-button {
            padding: 6px 12px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .bonus-btn {
            background: #28a745;
            color: white;
        }

        .bonus-btn:hover {
            background: #218838;
        }

        .change-pwd-btn {
            background: #ffc107;
            color: #212529;
        }

        .change-pwd-btn:hover {
            background: #e0a800;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
        }
.all-records-btn {
    background: #6f42c1;
    color: white;
}

.all-records-btn:hover {
    background: #5a32a3;
}

.daily-record-item {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    margin-bottom: 15px;
    overflow: hidden;
}

.daily-record-header {
    background: #e9ecef;
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.daily-record-header:hover {
    background: #dee2e6;
}

.daily-record-content {
    display: none;
    padding: 15px;
}

.daily-record-content.show {
    display: block;
}

.daily-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-bottom: 15px;
}

.daily-stat-item {
    background: white;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    border: 1px solid #dee2e6;
}

.expand-icon {
    transition: transform 0.3s;
}

.expand-icon.rotated {
    transform: rotate(180deg);
}

.view-records-btn {
    background: #17a2b8;
    color: white;
}

.view-records-btn:hover {
    background: #138496;
}

.user-records-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
}

.user-records-content {
    background-color: white;
    margin: 5% auto;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 1000px;
    max-height: 80vh;
    overflow-y: auto;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.stat-item {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
}

.stat-number {
    font-size: 2em;
    font-weight: bold;
    color: #FFC0CB;
}

.stat-label {
    color: #666;
    margin-top: 5px;
}

.records-controls {
    margin-bottom: 20px;
}

.records-controls input {
    margin-right: 10px;
}

        .records-section {
            margin-top: 20px;
        }

        .date-input {
            padding: 10px;
            border: 2px solid #FFC0CB;
            border-radius: 5px;
            margin-right: 10px;
        }

        .view-records-btn {
            background: #FFC0CB;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .view-records-btn:hover {
            background: #FF69B4;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            display: none;
        }

        .records-table th,
        .records-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .records-table th {
            background: #FFC0CB;
            color: white;
        }

        .correct-record {
            color: #27ae60;
            font-weight: bold;
        }

        .incorrect-record {
            color: #e74c3c;
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #FFC0CB;
            border-radius: 5px;
        }

        .modal-buttons {
            margin-top: 20px;
        }

        .modal-button {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .confirm-btn {
            background: #FFC0CB;
            color: white;
        }

 .cancel-btn {
            background: #6c757d;
            color: white;
        }

        .steps-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .steps-table th,
        .steps-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .steps-table th {
            background: #FFC0CB;
            color: white;
            font-weight: bold;
        }

        .step-complete {
            color: #28a745;
            font-size: 1.5em;
        }

        .step-incomplete {
            color: #dc3545;
            font-size: 1.5em;
        }

        .progress-bar-container {
            width: 100px;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 auto;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFC0CB, #FF69B4);
            transition: width 0.3s;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .ranking-table th,
        .ranking-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .ranking-table th {
            background: #FFC0CB;
            color: white;
            font-weight: bold;
        }

        .ranking-row-1 { background: #fff9e6; }
        .ranking-row-2 { background: #f5f5f5; }
        .ranking-row-3 { background: #fff0e6; }
        .ranking-row-4,
        .ranking-row-5 { background: #ffe6f0; }

        .badge-icon {
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .admin-section {
                padding: 15px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .users-table,
            .records-table {
                font-size: 12px;
            }
            
            .users-table th,
            .users-table td,
            .records-table th,
            .records-table td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">READIN ê´€ë¦¬ì</div>
        <div class="user-menu">
            <div class="username" onclick="toggleDropdown()"><%= username %> â–¼</div>
            <div class="dropdown" id="dropdown">
                <a href="/change-password">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
                <a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="admin-section">
            <h2 class="section-title">ì‹œìŠ¤í…œ ì„¤ì •</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <span>ìë™ íšŒì›ê°€ì… í—ˆìš©</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoSignup" <%= settings.auto_signup === '1' ? 'checked' : '' %> onchange="toggleSetting('auto_signup')">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>ì°¸ê°€ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í—ˆìš©</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="allowPasswordChange" <%= settings.allow_password_change === '1' ? 'checked' : '' %> onchange="toggleSetting('allow_password_change')">
                        <span class="slider"></span>
                    </label>
                </div>
<div class="setting-item">
    <span>í›ˆë ¨ ì¤‘ ì‹œê°ì  í”¼ë“œë°± í‘œì‹œ</span>
    <label class="toggle-switch">
        <input type="checkbox" id="showVisualFeedback" <%= settings.show_visual_feedback === '1' ? 'checked' : '' %> onchange="toggleSetting('show_visual_feedback')">
        <span class="slider"></span>
    </label>
</div>
            </div>
        </div>

        <div class="admin-section">
            <h2 class="section-title">ì°¸ê°€ì ê´€ë¦¬</h2>
            
            <div class="search-section">
                <input type="text" class="search-input" placeholder="ì°¸ê°€ì ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchUsers(this.value)">
            </div>

            <table class="users-table" id="usersTable">
                <thead>
                    <tr>
                        <th>ì‚¬ìš©ì ì´ë¦„</th>
                        <th>ë ˆë²¨</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                    <tr data-user-id="<%= user.id %>" data-username="<%= user.username %>">
                        <td><%= user.username %></td>
                        <td>
                            <select class="level-select" onchange="updateLevel(<%= user.id %>, this.value)">
                                <option value="1" <%= user.level === 1 ? 'selected' : '' %>>ë ˆë²¨ 1 (ì´ˆê¸‰)</option>
                                <option value="2" <%= user.level === 2 ? 'selected' : '' %>>ë ˆë²¨ 2 (ì¤‘ê¸‰)</option>
                                <option value="3" <%= user.level === 3 ? 'selected' : '' %>>ë ˆë²¨ 3 (ê¸°ë³¸)</option>
                            </select>
                        </td>
                      <td>
    <button class="action-button bonus-btn" onclick="giveBonus(<%= user.id %>)">ì¶”ê°€ ê¸°íšŒ</button>
    <button class="action-button change-pwd-btn" onclick="changePassword(<%= user.id %>, '<%= user.username %>')">ë¹„ë°€ë²ˆí˜¸</button>
    <button class="action-button all-records-btn" onclick="viewAllUserRecords(<%= user.id %>, '<%= user.username %>')">ì „ì²´ ê¸°ë¡</button>
    <button class="action-button delete-btn" onclick="deleteUser(<%= user.id %>, '<%= user.username %>')">ì‚­ì œ</button>
</td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

<div class="admin-section">
            <h2 class="section-title">ì›”ê°„ ë­í‚¹ ê´€ë¦¬</h2>
            
            <div class="ranking-controls" style="margin-bottom: 20px;">
                <label>ì¡°íšŒ ë…„ì›”:</label>
                <select id="rankingYear" style="padding: 8px; margin: 0 10px; border: 2px solid #FFC0CB; border-radius: 5px;">
                    <% for(let y = 2026; y <= 2030; y++) { %>
                        <option value="<%= y %>" <%= y === new Date().getFullYear() ? 'selected' : '' %>><%= y %>ë…„</option>
                    <% } %>
                </select>
                <select id="rankingMonth" style="padding: 8px; margin: 0 10px; border: 2px solid #FFC0CB; border-radius: 5px;">
                    <% for(let m = 1; m <= 12; m++) { %>
                        <option value="<%= m %>" <%= m === (new Date().getMonth() + 1) ? 'selected' : '' %>><%= m %>ì›”</option>
                    <% } %>
                </select>
                <button class="view-records-btn" onclick="loadRanking()" style="margin: 0 5px;">ë­í‚¹ ì¡°íšŒ</button>
                <button class="action-button bonus-btn" onclick="awardBadges()" style="margin: 0 5px;">ë°°ì§€ ìˆ˜ì—¬ (ìˆ˜ë™)</button>
            </div>

            <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #17a2b8;">
                <p style="color: #0c5460; margin: 0;">
                    <strong>ğŸ’¡ ìë™ ë°°ì§€ ìˆ˜ì—¬:</strong> ë§¤ë‹¬ ë§ì¼ 23:59ì— ìë™ìœ¼ë¡œ ìƒìœ„ 5ëª…ì—ê²Œ ë°°ì§€ê°€ ìˆ˜ì—¬ë©ë‹ˆë‹¤.<br>
                    <strong>âš ï¸ ìˆ˜ë™ ë²„íŠ¼:</strong> ê¸´ê¸‰ ìƒí™©ì´ë‚˜ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
                </p>
            </div>

            <div id="rankingDisplay">
                <p style="text-align: center; color: #666;">ë…„ì›”ì„ ì„ íƒí•˜ê³  'ë­í‚¹ ì¡°íšŒ' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
            </div>
        </div>

        <div class="admin-section">
            <h2 class="section-title">ì˜¤ëŠ˜ì˜ ë‹¨ê³„ ì™„ë£Œ í˜„í™©</h2>
            <div id="stepsStatus">
                <p style="text-align: center; color: #666;">ë¡œë”© ì¤‘...</p>
            </div>
        </div>

        <div class="admin-section">
            <h2 class="section-title">í›ˆë ¨ ê¸°ë¡ ì¡°íšŒ</h2>
            <div class="records-section">
    <div class="records-controls">
        <input type="date" class="date-input" id="recordDate" value="">
        <input type="text" class="search-input" id="userSearch" placeholder="í•™ìƒ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." style="width: 200px;">
        <button class="view-records-btn" onclick="viewRecords()">ê¸°ë¡ ì¡°íšŒ</button>
    </div>
                
                <table class="records-table" id="recordsTable">
                    <thead>
                        <tr>
                            <th>ì°¸ê°€ì</th>
                            <th>ì‹¤ì œ íšŸìˆ˜</th>
                            <th>ë‹µë³€</th>
                            <th>ê²°ê³¼</th>
                            <th>ë ˆë²¨</th>
                            <th>ì‹œê°„</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h3>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
            <p id="modalUserName"></p>
            <input type="password" class="modal-input" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸">
            <div class="modal-buttons">
                <button class="modal-button confirm-btn" onclick="confirmPasswordChange()">ë³€ê²½</button>
                <button class="modal-button cancel-btn" onclick="closeModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>ì‚¬ìš©ì ì‚­ì œ</h3>
            <p id="deleteUserName"></p>
            <p style="color: #dc3545; margin: 15px 0;"><strong>ê²½ê³ : ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</strong></p>
            <div class="modal-buttons">
                <button class="modal-button delete-btn" onclick="confirmDelete()">ì‚­ì œ</button>
                <button class="modal-button cancel-btn" onclick="closeModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

<script>
    let currentUserId = null;
    let dropdownTimeout;

// Set today's date as default
    document.getElementById('recordDate').value = new Date().toISOString().split('T')[0];

    // í˜ì´ì§€ ë¡œë“œì‹œ ë‹¨ê³„ ì™„ë£Œ í˜„í™© ì¡°íšŒ
    loadTodaySteps();

    async function loadTodaySteps() {
        try {
            const response = await fetch('/admin/today-steps');
            const result = await response.json();
            
            if (result.success && result.data.length > 0) {
                displayStepsStatus(result.data);
            } else {
                document.getElementById('stepsStatus').innerHTML = 
                    '<p style="text-align: center; color: #666;">ì˜¤ëŠ˜ í›ˆë ¨í•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        } catch (error) {
            console.error('ë‹¨ê³„ í˜„í™© ì¡°íšŒ ì˜¤ë¥˜:', error);
            document.getElementById('stepsStatus').innerHTML = 
                '<p style="text-align: center; color: #dc3545;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
    }

    function displayStepsStatus(data) {
        const html = `
            <table class="steps-table">
                <thead>
                    <tr>
                        <th>í•™ìƒ</th>
                        <th>1ë‹¨ê³„<br><small>ì•ˆêµ¬íšŒì „</small></th>
                        <th>2ë‹¨ê³„<br><small>ì„ ìƒë‹˜í•œë§ˆë””</small></th>
                        <th>3ë‹¨ê³„<br><small>ë…ì„œë…¸íŠ¸</small></th>
                        <th>4ë‹¨ê³„<br><small>ì½ê¸°ë“£ê¸°</small></th>
                        <th>5ë‹¨ê³„<br><small>ì±…ì½ê¸°</small></th>
                        <th>ì™„ë£Œìœ¨</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.map(user => `
                        <tr>
                            <td><strong>${user.username}</strong></td>
                            <td><span class="${user.step1 ? 'step-complete' : 'step-incomplete'}">${user.step1 ? 'âœ“' : 'âœ—'}</span></td>
                            <td><span class="${user.step2 ? 'step-complete' : 'step-incomplete'}">${user.step2 ? 'âœ“' : 'âœ—'}</span></td>
                            <td><span class="${user.step3 ? 'step-complete' : 'step-incomplete'}">${user.step3 ? 'âœ“' : 'âœ—'}</span></td>
                            <td><span class="${user.step4 ? 'step-complete' : 'step-incomplete'}">${user.step4 ? 'âœ“' : 'âœ—'}</span></td>
                            <td><span class="${user.step5 ? 'step-complete' : 'step-incomplete'}">${user.step5 ? 'âœ“' : 'âœ—'}</span></td>
                            <td>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: ${(user.completed_count / 5) * 100}%"></div>
                                </div>
                                <small>${user.completed_count}/5</small>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
        
        document.getElementById('stepsStatus').innerHTML = html;
    }
    function toggleDropdown() {
        const dropdown = document.getElementById('dropdown');
        dropdown.classList.toggle('show');
    }

    document.querySelector('.user-menu').addEventListener('mouseenter', function() {
        clearTimeout(dropdownTimeout);
        document.getElementById('dropdown').classList.add('show');
    });

    document.querySelector('.user-menu').addEventListener('mouseleave', function() {
        dropdownTimeout = setTimeout(function() {
            document.getElementById('dropdown').classList.remove('show');
        }, 300);
    });

    async function toggleSetting(key) {
        try {
            const response = await fetch('/admin/toggle-setting', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ key })
            });
            
            const result = await response.json();
            if (!result.success) {
                alert('ì„¤ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                location.reload();
            }
        } catch (error) {
            alert('ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            location.reload();
        }
    }

    async function searchUsers(searchTerm) {
        if (searchTerm.length === 0) {
            location.reload();
            return;
        }

        try {
            const response = await fetch('/admin/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ searchTerm })
            });
            
            const result = await response.json();
            updateUsersTable(result.users);
        } catch (error) {
            console.error('Search error:', error);
        }
    }

    function updateUsersTable(users) {
        const tbody = document.querySelector('#usersTable tbody');
        tbody.innerHTML = '';
        
        users.forEach(user => {
            const row = document.createElement('tr');
            row.setAttribute('data-user-id', user.id);
            row.setAttribute('data-username', user.username);
row.innerHTML = `
    <td>${user.username}</td>
    <td>
        <select class="level-select" onchange="updateLevel(${user.id}, this.value)">
            <option value="1" ${user.level === 1 ? 'selected' : ''}>ë ˆë²¨ 1 (ì´ˆê¸‰)</option>
            <option value="2" ${user.level === 2 ? 'selected' : ''}>ë ˆë²¨ 2 (ì¤‘ê¸‰)</option>
            <option value="3" ${user.level === 3 ? 'selected' : ''}>ë ˆë²¨ 3 (ê¸°ë³¸)</option>
        </select>
    </td>
    <td>
        <button class="action-button bonus-btn" onclick="giveBonus(${user.id})">ì¶”ê°€ ê¸°íšŒ</button>
        <button class="action-button change-pwd-btn" onclick="changePassword(${user.id}, '${user.username}')">ë¹„ë°€ë²ˆí˜¸</button>
        <button class="action-button all-records-btn" onclick="viewAllUserRecords(${user.id}, '${user.username}')">ì „ì²´ ê¸°ë¡</button>
        <button class="action-button delete-btn" onclick="deleteUser(${user.id}, '${user.username}')">ì‚­ì œ</button>
    </td>
`;
            tbody.appendChild(row);
        });
    }

    async function updateLevel(userId, level) {
        try {
            const response = await fetch('/admin/update-level', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId, level: parseInt(level) })
            });
            
            const result = await response.json();
            if (result.success) {
                alert('ë ˆë²¨ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert(result.message || 'ë ˆë²¨ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            alert('ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    async function giveBonus(userId) {
        if (!confirm('ì´ ì°¸ê°€ìì—ê²Œ ì¶”ê°€ ë„ì „ ê¸°íšŒë¥¼ ì£¼ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            return;
        }

        try {
            const response = await fetch('/admin/bonus-attempt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId })
            });
            
            const result = await response.json();
            if (result.success) {
                alert('ì¶”ê°€ ë„ì „ ê¸°íšŒê°€ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('ì¶”ê°€ ê¸°íšŒ ë¶€ì—¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            alert('ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function changePassword(userId, username) {
        currentUserId = userId;
        document.getElementById('modalUserName').textContent = `${username}ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.`;
        document.getElementById('newPassword').value = '';
        document.getElementById('passwordModal').style.display = 'block';
    }

    async function confirmPasswordChange() {
        const newPassword = document.getElementById('newPassword').value;
        if (!newPassword) {
            alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        try {
            const response = await fetch('/admin/force-change-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    userId: currentUserId, 
                    newPassword 
                })
            });
            
            const result = await response.json();
            if (result.success) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeModal();
            } else {
                alert(result.message || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            alert('ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function deleteUser(userId, username) {
        currentUserId = userId;
        document.getElementById('deleteUserName').textContent = `ì •ë§ë¡œ "${username}" ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        document.getElementById('deleteModal').style.display = 'block';
    }

    async function confirmDelete() {
        try {
            const response = await fetch('/admin/delete-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId: currentUserId })
            });
            
            const result = await response.json();
            if (result.success) {
                alert('ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeModal();
                location.reload();
            } else {
                alert(result.message || 'ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            alert('ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function closeModal() {
        document.getElementById('passwordModal').style.display = 'none';
        document.getElementById('deleteModal').style.display = 'none';
        currentUserId = null;
    }

    async function viewRecords() {
        const date = document.getElementById('recordDate').value;
        const userSearch = document.getElementById('userSearch').value;
        
        if (!date) {
            alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        try {
            let url = `/admin/records/${date}`;
            if (userSearch) {
                url += `?user=${encodeURIComponent(userSearch)}`;
            }
            
            const response = await fetch(url);
            const result = await response.json();
                    
            const recordsBody = document.getElementById('recordsBody');
            const recordsTable = document.getElementById('recordsTable');
            
            recordsBody.innerHTML = '';
            
            if (result.records && result.records.length > 0) {
                result.records.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.username}</td>
                        <td>${record.actual_count}</td>
                        <td>${record.user_answer}</td>
                        <td class="${record.is_correct ? 'correct-record' : 'incorrect-record'}">
                            ${record.is_correct ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}
                        </td>
                        <td>ë ˆë²¨ ${record.level}</td>
                        <td>${record.timestamp ? record.timestamp.substring(11, 19) : '-'}</td>
                    `;
                    recordsBody.appendChild(row);
                });
                recordsTable.style.display = 'table';
            } else {
                recordsBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">í•´ë‹¹ ë‚ ì§œì— ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                recordsTable.style.display = 'table';
            }
        } catch (error) {
            alert('ê¸°ë¡ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            console.error('Error:', error);
        }
    }

    // í•™ìƒë³„ ê¸°ë¡ ë³´ê¸°
    async function viewUserRecords(userId, username) {
        console.log('ê¸°ë¡ ì¡°íšŒ ì‹œì‘:', userId, username);
        
        try {
            const statsResponse = await fetch(`/admin/user-stats/${userId}`);
            const statsData = await statsResponse.json();
            console.log('í†µê³„ ë°ì´í„°:', statsData);
            
            const recordsResponse = await fetch(`/admin/user-records/${userId}?page=1&limit=50`);
            const recordsData = await recordsResponse.json();
            console.log('ê¸°ë¡ ë°ì´í„°:', recordsData);
            
            if (recordsData.success && recordsData.records) {
                showUserRecordsModal(username, statsData.stats, recordsData);
            } else {
                alert('í•´ë‹¹ ì‚¬ìš©ìì˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            console.error('í•™ìƒ ê¸°ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
            alert('ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function showUserRecordsModal(username, stats, recordsData) {
       const records = recordsData.records || [];
const totalRecords = recordsData.totalRecords || records.length;

console.log('ëª¨ë‹¬ì— ì „ë‹¬ëœ ê¸°ë¡:', records);
console.log('ê¸°ë¡ ê°œìˆ˜:', records.length);
        
        const modalHtml = `
            <div class="user-records-modal" id="userRecordsModal">
                <div class="user-records-content">
                    <h2>${username}ì˜ í›ˆë ¨ ê¸°ë¡ (ì´ ${totalRecords}ê°œ)</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">${stats.totalAttempts}</div>
                            <div class="stat-label">ì´ í›ˆë ¨ íšŸìˆ˜</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${stats.accuracy}%</div>
                            <div class="stat-label">ì •ë‹µë¥ </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${stats.correctAnswers}</div>
                            <div class="stat-label">ì •ë‹µ íšŸìˆ˜</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${stats.recentWeek}</div>
                            <div class="stat-label">ìµœê·¼ 7ì¼</div>
                        </div>
                    </div>
                    
                    <h3>í›ˆë ¨ ê¸°ë¡</h3>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="records-table">
                            <thead>
                                <tr>
                                    <th>ë‚ ì§œ</th>
                                    <th>ì‹¤ì œ íšŸìˆ˜</th>
                                    <th>ë‹µë³€</th>
                                    <th>ê²°ê³¼</th>
                                    <th>ë ˆë²¨</th>
                                    <th>ë‚œì´ë„</th>
                                    <th>ì‹œê°„</th>
                                </tr>
                            </thead>
                           <tbody>
    ${records.length > 0 ? records.map(record => `
        <tr>
            <td>${record.date || '-'}</td>
            <td>${record.actual_count || '-'}</td>
            <td>${record.user_answer || '-'}</td>
            <td class="${record.is_correct ? 'correct-record' : 'incorrect-record'}">
                ${record.is_correct ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}
            </td>
            <td>ë ˆë²¨ ${record.level || '-'}</td>
            <td>${record.difficulty_range || '-'}</td>
            <td>${record.timestamp ? record.timestamp.substring(11, 19) : '-'}</td>
        </tr>
    `).join('') : '<tr><td colspan="7" style="text-align: center; padding: 20px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>'}
</tbody>
                        </table>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="modal-button cancel-btn" onclick="closeUserRecordsModal()">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        document.getElementById('userRecordsModal').style.display = 'block';
    }

   function closeUserRecordsModal() {
    const modal = document.getElementById('userRecordsModal');
    if (modal) {
        modal.remove();
    }
}

// ì—¬ê¸°ì— ìƒˆë¡œìš´ í•¨ìˆ˜ë“¤ ì¶”ê°€ â†“

// ì°¸ê°€ìë³„ ì „ì²´ ê¸°ë¡ ë³´ê¸°
async function viewAllUserRecords(userId, username) {
    try {
        console.log('ì „ì²´ ê¸°ë¡ ì¡°íšŒ ì‹œì‘:', userId, username);
        
        const statsResponse = await fetch(`/admin/user-stats/${userId}`);
        const statsData = await statsResponse.json();
        
        console.log('í†µê³„ ë°ì´í„°:', statsData);
        
        if (!statsData.success || !statsData.stats) {
            alert('í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        const allRecordsResponse = await fetch(`/admin/user-all-records/${userId}`);
        const allRecordsData = await allRecordsResponse.json();
        
        console.log('ì „ì²´ ê¸°ë¡ ë°ì´í„°:', allRecordsData);
        
        if (!allRecordsData.success) {
            alert('ê¸°ë¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        showAllUserRecordsModal(username, statsData.stats, allRecordsData.dailyRecords);
    } catch (error) {
        console.error('ì „ì²´ ê¸°ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ì „ì²´ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
}

function showAllUserRecordsModal(username, stats, dailyRecords) {
    // statsê°€ nullì´ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
    const safeStats = stats || {
        totalAttempts: 0,
        accuracy: 0,
        correctAnswers: 0
    };
    
    const safeDailyRecords = dailyRecords || [];
    
    const modalHtml = `
        <div class="user-records-modal" id="allUserRecordsModal">
            <div class="user-records-content" style="max-width: 1200px;">
                <h2>${username}ì˜ ì „ì²´ í›ˆë ¨ ê¸°ë¡</h2>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">${safeStats.totalAttempts}</div>
                        <div class="stat-label">ì´ í›ˆë ¨ íšŸìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${safeStats.accuracy}%</div>
                        <div class="stat-label">ì •ë‹µë¥ </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${safeStats.correctAnswers}</div>
                        <div class="stat-label">ì •ë‹µ íšŸìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${safeDailyRecords.length}</div>
                        <div class="stat-label">í›ˆë ¨ ì¼ìˆ˜</div>
                    </div>
                </div>
                
               <h3>ë‚ ì§œë³„ í›ˆë ¨ ê¸°ë¡</h3>
                <div style="max-height: 500px; overflow-y: auto;">
                    ${safeDailyRecords.length > 0 ? safeDailyRecords.map((daily, index) => `
                        <div class="daily-record-item">
                            <div class="daily-record-header" onclick="toggleDailyRecord(${index})">
                                <div>
                                    <strong>${daily.date}</strong> 
                                    <span style="margin-left: 15px; color: #666;">
                                        ${daily.daily_attempts}íšŒ ì‹œë„ | 
                                        ${daily.correct_count}/${daily.daily_attempts} ì •ë‹µ |
                                        ë ˆë²¨ ${daily.level} (${daily.difficulty_range || '-'})
                                    </span>
                                </div>
                                <span class="expand-icon" id="icon-${index}">â–¼</span>
                            </div>
                            <div class="daily-record-content" id="content-${index}">
                                <div class="daily-stats">
                                    <div class="daily-stat-item">
                                        <strong>${daily.daily_attempts}</strong><br>
                                        <small>ì´ ì‹œë„</small>
                                    </div>
                                    <div class="daily-stat-item">
                                        <strong>${daily.correct_count}</strong><br>
                                        <small>ì •ë‹µ ìˆ˜</small>
                                    </div>
                                    <div class="daily-stat-item">
                                        <strong>${Math.round((daily.correct_count / daily.daily_attempts) * 100)}%</strong><br>
                                        <small>ì •ë‹µë¥ </small>
                                    </div>
                                    <div class="daily-stat-item">
                                        <strong>${daily.avg_actual_count}</strong><br>
                                        <small>í‰ê·  íšŸìˆ˜</small>
                                    </div>
                                </div>
                                
                                <table class="records-table">
                                    <thead>
                                        <tr>
                                            <th>ì‹œê°„</th>
                                            <th>ì‹¤ì œ íšŸìˆ˜</th>
                                            <th>ë‹µë³€</th>
                                            <th>ê²°ê³¼</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${daily.records.map(record => `
                                            <tr>
                                                <td>${record.timestamp.substring(11, 19)}</td>
                                                <td>${record.actual_count}</td>
                                                <td>${record.user_answer}</td>
                                                <td class="${record.is_correct ? 'correct-record' : 'incorrect-record'}">
                                                    ${record.is_correct ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `).join('') : '<p style="text-align: center; padding: 40px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="modal-button cancel-btn" onclick="closeAllUserRecordsModal()">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    `;
    
 document.body.insertAdjacentHTML('beforeend', modalHtml);
    document.getElementById('allUserRecordsModal').style.display = 'block';
}

function toggleDailyRecord(index) {
    const content = document.getElementById(`content-${index}`);
    const icon = document.getElementById(`icon-${index}`);
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.classList.remove('rotated');
    } else {
        content.classList.add('show');
        icon.classList.add('rotated');
    }
}

function closeAllUserRecordsModal() {
    const modal = document.getElementById('allUserRecordsModal');
    if (modal) {
        modal.remove();
    }
}

    // Close modals when clicking outside
window.onclick = function(event) {
    const passwordModal = document.getElementById('passwordModal');
    const deleteModal = document.getElementById('deleteModal');
    const userRecordsModal = document.getElementById('userRecordsModal');
    const allUserRecordsModal = document.getElementById('allUserRecordsModal');
    
    if (event.target === passwordModal) {
        passwordModal.style.display = 'none';
    }
    if (event.target === deleteModal) {
        deleteModal.style.display = 'none';
    }
    if (event.target === userRecordsModal) {
        closeUserRecordsModal();
    }
    if (event.target === allUserRecordsModal) {
        closeAllUserRecordsModal();
    }
}

    // ë­í‚¹ ì¡°íšŒ
    async function loadRanking() {
        const year = document.getElementById('rankingYear').value;
        const month = document.getElementById('rankingMonth').value;
        
        try {
            const response = await fetch(`/admin/full-ranking?year=${year}&month=${month}`);
            const result = await response.json();
            
            if (result.success && result.rankings.length > 0) {
                displayRanking(result.rankings, year, month);
            } else {
                document.getElementById('rankingDisplay').innerHTML = 
                    `<p style="text-align: center; color: #666;">${year}ë…„ ${month}ì›”ì—ëŠ” í›ˆë ¨ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }
        } catch (error) {
            console.error('ë­í‚¹ ì¡°íšŒ ì˜¤ë¥˜:', error);
            alert('ë­í‚¹ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function displayRanking(rankings, year, month) {
        const html = `
            <h3 style="margin-bottom: 15px;">${year}ë…„ ${month}ì›” ì „ì²´ ë­í‚¹ (ì´ ${rankings.length}ëª…)</h3>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>ìˆœìœ„</th>
                        <th>ì´ë¦„</th>
                        <th>ì´ì </th>
                        <th>ì •ë‹µë¥ </th>
                        <th>ì™„ë²½</th>
                        <th>ê·¼ì‚¬</th>
                        <th>ì˜¤ë‹µ</th>
                        <th>ì‹œë„</th>
                        <th>ë°°ì§€</th>
                    </tr>
                </thead>
                <tbody>
                    ${rankings.map((rank, index) => `
                        <tr class="ranking-row-${Math.min(index + 1, 6)}">
                            <td>
                                ${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : index < 5 ? 'ğŸ–ï¸' : ''}
                                ${index + 1}ìœ„
                            </td>
                            <td><strong>${rank.username}</strong></td>
                            <td><strong style="color: #FFC0CB;">${rank.total_score}ì </strong></td>
                            <td>${rank.accuracy}%</td>
                            <td>${rank.perfect_count}</td>
                            <td>${rank.close_count}</td>
                            <td>${rank.wrong_count}</td>
                            <td>${rank.total_attempts}</td>
                            <td>
                                ${index === 0 ? 'ğŸ¥‡ ê³¨ë“œ' : index === 1 ? 'ğŸ¥ˆ ì‹¤ë²„' : index === 2 ? 'ğŸ¥‰ ë¸Œë¡ ì¦ˆ' : index < 5 ? 'ğŸ–ï¸ ìš°ìˆ˜' : '-'}
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
        
        document.getElementById('rankingDisplay').innerHTML = html;
    }

    // ë°°ì§€ ìˆ˜ì—¬
    async function awardBadges() {
        const year = document.getElementById('rankingYear').value;
        const month = document.getElementById('rankingMonth').value;
        
        if (!confirm(`${year}ë…„ ${month}ì›” ìƒìœ„ 5ëª…ì—ê²Œ ë°°ì§€ë¥¼ ìˆ˜ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            return;
        }
        
        try {
            const response = await fetch('/admin/award-badges', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ year: parseInt(year), month: parseInt(month) })
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert('ë°°ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadRanking(); // ë‹¤ì‹œ ë¡œë“œ
            } else {
                alert(result.message || 'ë°°ì§€ ìˆ˜ì—¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            console.error('ë°°ì§€ ìˆ˜ì—¬ ì˜¤ë¥˜:', error);
            alert('ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const userMenu = document.querySelector('.user-menu');
        if (!userMenu.contains(event.target)) {
            document.getElementById('dropdown').classList.remove('show');
        }
    });
</script>
</body>
</html>
